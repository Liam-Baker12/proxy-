<!DOCTYPE html>
<html>
<head>
    <title>Pyodide Proxy</title>
</head>
<body>
    <h1>Pyodide Proxy Test</h1>
    <input type="text" id="url" placeholder="Enter URL (e.g., https://example.com)" size="50">
    <button onclick="runPython()">Fetch</button>
    <pre id="output">Waiting for input...</pre>

    <script type="text/javascript">
        async function loadPyodideAndPackages() {
            window.pyodide = await loadPyodide();
            await pyodide.loadPackage("micropip");
            await pyodide.runPythonAsync(await (await fetch("main.py")).text());
        }

        async function runPython() {
            const url = document.getElementById("url").value;
            const output = await pyodide.runPythonAsync(`await proxy_get("${url}")`);
            document.getElementById("output").textContent = output;
        }

        loadPyodideAndPackages();
    </script>

    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <!-- Load Pyodide from CDN -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
<script>
  async function main() {
    const pyodide = await loadPyodide();
    document.getElementById("output").textContent = "✅ Pyodide ready!";

    // Run some Python code in the browser
    let version = await pyodide.runPythonAsync(`
        import sys
        sys.version
    `);
    console.log("Python version:", version);
  }

  main();
</script>
<!-- Load Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
<script>
  let pyodide;

  async function initPyodide() {
    pyodide = await loadPyodide();
    document.getElementById("output").textContent = "✅ Pyodide ready!";
  }

  async function runProxy() {
    const url = document.getElementById("url-input").value;
    if (!url) {
      document.getElementById("output").textContent = "Please enter a URL.";
      return;
    }

    try {
      let result = await pyodide.runPythonAsync(`
        from js import fetch
        import asyncio

        async def get_data():
            response = await fetch("${url}")
            return await response.text()

        asyncio.run(get_data())
      `);
      document.getElementById("output").textContent = result;
    } catch (err) {
      document.getElementById("output").textContent = "❌ Error: " + err;
    }
  }

  initPyodide();
</script>

</body>
</html>
